<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vasavi Sarovar — Opening…</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root { --bg:#07121a; --panel:rgba(0,0,0,0.5); --accent:#f6a65b; --muted:#c7dbe6; }
    html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Arial,Helvetica,sans-serif}
    .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:28px;box-sizing:border-box}
    .card{width:100%;max-width:520px;background:var(--panel);padding:20px;border-radius:12px;text-align:center;box-shadow:0 12px 30px rgba(0,0,0,0.6)}
    h1{margin:0;font-size:18px;letter-spacing:0.4px}
    p{margin:10px 0 0;color:var(--muted);font-size:13px}
    .loader{margin-top:18px;width:48px;height:48px;border-radius:50%;border:4px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 1s linear infinite;margin-left:auto;margin-right:auto}
    @keyframes spin{to{transform:rotate(360deg)}}
    .small{font-size:12px;color:#9fb8c9;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap" role="main" aria-live="polite">
    <div class="card">
      <h1>Opening Vasavi Sarovar — Handover Countdown</h1>
      <p>Loading the countdown — this will open automatically.</p>
      <div class="loader" aria-hidden="true"></div>
      <div class="small">If nothing happens, open <a href="countdown.html" style="color:var(--accent);text-decoration:none">the countdown page</a>.</div>
    </div>
  </div>

<script>
/*
  index.html: root entry that logs scan to Google Apps Script then redirects to countdown.html
  Replace webAppUrl below only if your Apps Script exec URL changes.
*/
(async function(){
  const webAppUrl = "https://script.google.com/macros/s/AKfycbwH17mjcnCfXR9VCBZMSOi_Dkn_PffPbamR8m0FFYrCCvdUpcdSI55vxMfzleHr25vC_Q/exec";

  // get public IP (best-effort)
  async function getIP(){
    try {
      const r = await fetch("https://api.ipify.org?format=json");
      const j = await r.json();
      return j.ip || "NA";
    } catch(_) { return "NA"; }
  }

  // get geolocation (best-effort, will prompt user) with short timeout
  function getLocation(){
    return new Promise((resolve) => {
      if(!navigator.geolocation) return resolve(null);
      let done = false;
      const timer = setTimeout(()=>{ if(!done){ done=true; resolve(null); } }, 4500);
      navigator.geolocation.getCurrentPosition(pos => {
        if(done) return;
        done = true; clearTimeout(timer);
        resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude });
      }, err => { if(!done){ done = true; clearTimeout(timer); resolve(null); } }, { timeout: 4500 });
    });
  }

  try {
    const ip = await getIP();
    const loc = await getLocation();

    const payload = {
      device: navigator.platform || "unknown",
      browser: navigator.userAgent || "unknown",
      screen: (window.screen && (window.screen.width + "x" + window.screen.height)) || "",
      ip: ip,
      lat: loc ? loc.lat : "",
      lon: loc ? loc.lon : ""
    };

    // fire-and-forget POST (do not block UX)
    fetch(webAppUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
      mode: "cors"
    }).catch(()=>{/* ignore errors */});
  } catch(e){
    // ignore any logging errors
  } finally {
    // go to countdown page (same folder). Use replace() to avoid back-button clutter.
    window.location.replace("countdown.html");
  }
})();
</script>
</body>
</html>
