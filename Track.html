<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Loading...</title>
  <style>body{font-family:Arial,Helvetica,sans-serif;background:#07121a;color:#fff;text-align:center;padding-top:20vh}</style>
</head>
<body>
  <div style="max-width:420px;margin:0 auto;padding:24px;">
    <h3 style="margin:0 0 8px">Opening Vasavi Sarovar Countdown…</h3>
    <p style="opacity:0.85;margin:0 0 18px">Please wait — this will open automatically.</p>
    <div id="status" style="opacity:0.9;font-size:13px">Logging scan...</div>
  </div>

<script>
(async function(){
  // ← Your deployed Google Apps Script web app (exec) URL (provided by you)
  const webAppUrl = "https://script.google.com/macros/s/AKfycbwGpnSot-PK-xtJc0NF7wDlIYWRaxg3gXi1qXeviuqgWOWn8ZRbnVpVnmY39KyEyi84-A/exec";

  function getIP(){
    return fetch("https://api.ipify.org?format=json")
      .then(r => r.json())
      .then(j => j.ip)
      .catch(_ => "NA");
  }

  function getLocation(){
    return new Promise((resolve) => {
      if (!navigator.geolocation) return resolve(null);
      let done = false;
      const timer = setTimeout(()=> { if(!done){ done=true; resolve(null); } }, 5000); // 5s timeout
      navigator.geolocation.getCurrentPosition(pos => {
        if(done) return;
        done = true; clearTimeout(timer);
        resolve({lat: pos.coords.latitude, lon: pos.coords.longitude});
      }, err => { if(!done){ done=true; clearTimeout(timer); resolve(null);} }, {timeout:5000});
    });
  }

  try {
    const ip = await getIP();
    const loc = await getLocation();
    const payload = {
      device: navigator.platform || "unknown",
      browser: navigator.userAgent || "unknown",
      screen: (window.screen && (window.screen.width + "x" + window.screen.height)) || "",
      ip: ip,
      lat: loc ? loc.lat : "",
      lon: loc ? loc.lon : ""
    };

    // Send to Google Apps Script web app (we include CORS & proper content-type)
    await fetch(webAppUrl, {
      method: "POST",
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload),
      mode: 'cors'
    }).catch(e => { /* swallow errors; still redirect */ });

  } catch(err){
    // ignore, continue
  } finally {
    // Redirect to countdown page (in same folder)
    window.location.replace("countdown.html");
  }
})();
</script>
</body>
</html>
